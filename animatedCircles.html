<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<style>
    body {
        font-family: "Helvetica Neue", Helvetica, sans-serif;
        font-size: 14px;
        color: #333;
    }
    circle.text {
        fill: orange;
    }
    g.item text {
        fill: #ddd;
        font-size: 70px;
        text-anchor: middle;
        font-weight: bold;
    }
    g.item-append text {
        fill: #ddd;
        font-size: 70px;
        text-anchor: middle;
        font-weight: bold;
    }
    .status {
        margin-left: 3%
    }
</style>

<body>
    <div>
        <button onClick="update();">ANIMATION</button>
    </div>
    <svg width="900" height="510" class="animated-circles">
    </svg>

    <svg width="760" height="140">
        <g transform="translate(70, 70)">
            <circle class="clickable" r="40" />
            <circle class="clickable" r="40" cx="120" />
            <circle class="clickable" r="40" cx="240" />
            <circle class="clickable" r="40" cx="360" />
            <circle class="clickable" r="40" cx="480" />
        </g>
    </svg>

    <svg width="760" height="140">
        <g transform="translate(70, 70)">
            <g class="item" transform="translate(0, 0)"><circle class="text" r="40" /></g>
            <g class="item" transform="translate(120, 0)"><circle class="text" r="40" /></g>
            <g class="item" transform="translate(240, 0)"><circle class="text" r="40" /></g>
            <g class="item-append" transform="translate(360, 0)"><circle class="text" r="40" /></g>
            <g class="item-append" transform="translate(480, 0)"><circle class="text" r="40" /></g>
            <g class="item-append" transform="translate(600, 0)"><circle class="text" r="40" /></g>
        </g>
    </svg>

    <svg width="760" height="140">
        <g transform="translate(70, 70)">
            <circle class="chain-example" r="40" />
            <circle class="chain-example" r="40" cx="120" />
            <circle class="chain-example" r="40" cx="240" />
            <circle class="chain-example" r="40" cx="360" />
            <circle class="chain-example" r="40" cx="480" />
        </g>
    </svg>
    <div class="status">Click on a circle</div>

    <svg width="760" height="140">
        <g transform="translate(70, 70)">
            <circle class="each-example" r="40" />
            <circle class="each-example" r="40" cx="120" />
            <circle class="each-example" r="40" cx="240" />
            <circle class="each-example" r="40" cx="360" />
            <circle class="each-example" r="40" cx="480" />
            <circle class="each-example" r="40" cx="620" />
        </g>
    </svg>

<script src="//d3js.org/d3.v4.min.js"></script>
<script>
	let data = [];
	let numCircles = 200;
	let width = 750;
	let height = 400;
	let maxRadius = 10;

	const random = (x) => {
		return Math.floor(Math.random() * x);
    }

    const randomise = () => {
		data = [];
		for(let i = 0; i < numCircles; i++){
			data.push({
                x: random(width) + 70,
                y: random(height) + 70,
                r: random(maxRadius) + 20,
                fill: d3.rgb(random(255), random(255), random(255))
            })
        }
    }

    const update = () => {
		randomise();

		let u = d3.select('.animated-circles').selectAll('circle').data(data);

		//enter
        u.enter().append('circle')
            .attr('r', 0)
            .attr('cx', width / 2)
            .attr('cy', height / 2)
            .style('fill', 'white')
            .merge(u)
            .transition()
            .duration(1500)
            .attr('cx', (d) => { return d.x; })
            .attr('cy', (d) => { return d.y; })
            .attr('r', (d) => { return d.r; })
            .style('fill', (d) => { return d.fill; });

	    //exit
	    u.exit()
		    .transition()
		    .duration(1500)
		    .attr('r', 0)
		    .style('opacity', 0)
		    .each('end', () => {
			    d3.select(this).remove();
		    })
	}
	update();

	setInterval(() => {
		update();
    }, 1500)

	d3.selectAll('.clickable')
        .style('fill', '#ddd')
        .on('click', function (d, i) {
	        if(d3.select(this).style('fill') === 'orange'){
		        d3.select(this).style('fill', '#ddd');
	        } else {
		        d3.select(this).style('fill', 'orange');
	        }
        })

    //item insert (text behind circles)
    d3.selectAll('g.item')
        .insert('text', 'circle')
        .text((d, i) => {
        	return i + 1;
        })
        .attr('y', 50)
        .attr('x', 30);

	//item append (text in front of circles)
	d3.selectAll('g.item-append')
		.append('text')
		.text((d, i) => {
			return i + 4;
		})
		.attr('y', 50)
		.attr('x', 30);

	//chain example + each
	d3.selectAll('.chain-example')
        .each(function (d, i) {
        	d3.select(this)
                .style('fill', 'orange')
		        .attr('r', random(40) + 10)
		        .on('click', () => {
			        d3.select('.status')
				        .text('You clicked on circle ' + i)
				        .style('margin-left', '2.75%')
		        })
        })

    //each example
    d3.selectAll('.each-example')
        .each(function (d, i) {
        	console.log(d, i);
        	let odd = i % 2 === 1;
        	d3.select(this)
                .style('fill', odd ? 'orange' : '#ddd')
                .attr('r', odd ? 40 : 20);
        })

</script>
</body>
</html>